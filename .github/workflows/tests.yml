name: tests
on: 
  push:
    branches:
      - 'main'
  pull_request:
    branches:
      - 'main'
  workflow_dispatch:
    inputs:
      enable_debug_tmate:
        required: false
        type: boolean
        default: false

jobs:
  # TODO: add test matrix for v9+ nightly
  plenary:
    runs-on: ubuntu-22.04
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Install git-prompt-string
      run: |
        go install github.com/mikesmithgh/git-prompt-string@latest 

    - name: Setup Neovim ${{ matrix.nvim_version }} 
      uses: rhysd/action-setup-vim@v1
      with:
        neovim: true
        version: 'stable'

    - name: (debug) Setup tmate session
      if: ${{ inputs.enable_debug_tmate }}
      uses: mxschmitt/action-tmate@v3

    - name: Test git-prompt-string-lualine
      run: |
        export PATH="$PATH:$HOME/go/bin"
        make test

